<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>～一起来气味王国玩吧～</title>

<script src="http://code.createjs.com/easeljs-0.8.1.min.js"></script>
<script src="http://code.createjs.com/tweenjs-0.6.1.min.js"></script>
<script src="http://code.createjs.com/movieclip-0.8.1.min.js"></script>
<script src="http://code.createjs.com/preloadjs-0.6.1.min.js"></script>
<script src="http://code.createjs.com/soundjs-0.6.1.min.js"></script>
<script src="invitation2.js"></script>
<script src='libs/sonic.js'></script>
<link rel="stylesheet" href="css/main.css" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<script>
var canvas, stage, exportRoot,biliWidth,biliHeight,playSoundId,BodyWidth,BodyHeight;
var soundDate = [42000,59000];
var time_sound = 0;
var time_flg = true;
var time_go = 0;
var time_sound_auto = setInterval(function() {
    if(time_go !== 0) {
      var tempTimeDate = new Date(); 
      time_sound =  tempTimeDate.getTime() - time_go.getTime() + 2000;
    }
    console.log(time_sound);
},10);
function init() {
  document.getElementById('sound').addEventListener('click',function(e) {
    var dom = e.target;
    if(dom.getAttribute('soundFlg') === 'true') {
      dom.setAttribute('soundFlg', 'false');
      dom.src = 'images/sound.png';
      createjs.Sound.stop();
      time_flg = false;
    } else {
      dom.setAttribute('soundFlg', 'true');
      dom.src = 'images/sound-y.png';
      if (time_go != 0) {
        if (playSoundId === 'invitation_musical_1') {
          createjs.Sound.play(playSoundId, { interrupt: 'none', startTime: time_sound, duration: soundDate[0] - time_sound });
        } else if (playSoundId === "invitation_musical3"){
          console.log('-------------------------------------------------'+time_sound);
          createjs.Sound.play(playSoundId, { interrupt: 'none', startTime: time_sound, duration: soundDate[1] - time_sound });
        }
      }
      time_flg = true;
      playSound("invitation_musical",2);
    }
  });

  var circle = new Sonic({
    width: 50,
    height: 50,
    padding: 50,
    strokeColor: '#000',
    pointDistance: .01,
    stepsPerFrame: 3,
    trailLength: .7,
    step: 'fader',
    setup: function() {
      this._.lineWidth = 5;
    },
    path: [
        ['arc', 25, 25, 25, 0, 360]
    ]
  });
  circle.play();
  circle.canvas.style.marginLeft = '-75px';
  circle.canvas.style.marginTop = '-75px';
  document.getElementById('preload').appendChild(circle.canvas);
  
canvas = document.getElementById("canvas");
//----------------------------------------------------
//设置canvas 自适应 START
window.onresize = function(){
  canvas.width = 0;
  canvas.height = 0;
  resizeCanvas();
}
BodyWidth = document.body.scrollWidth;
BodyHeight = document.body.scrollHeight;
function resizeCanvas() {
  BodyWidth = document.body.scrollWidth;
  BodyHeight = document.body.scrollHeight;
  canvas.width = BodyWidth;
  canvas.height = BodyHeight;
  if (canvas.width < canvas.height) {
    biliWidth = BodyWidth / 750;
    biliHeight = BodyHeight / 1334;
  } else {
    biliWidth = BodyHeight / 750;
    biliHeight = BodyWidth / 1334;
  }
  if (canvas.width > 750) {
    var dom = document.getElementById('sound');
    var sound_scale = 83 / 83;
    var sound_width = 83 * biliWidth;
    var sound_height = parseInt( sound_width / sound_scale);
    dom.width = sound_width;
    dom.height = sound_height;
    dom.style.bottom = 10 + 'px';
    left = BodyWidth / 2 ;
    if(canvas.width < canvas.height) {
      dom.style.left =  (left + canvas.width / 3)+ 'px';
      dom.style.transform = 'rotate('+ 0 + 'deg)';
    } else {
      dom.style.left =  10 + 'px';
      dom.style.transform = 'rotate('+ 90 + 'deg)';
    }
  } else {
    var dom = document.getElementById('sound');
    var sound_scale = 83 / 83;
    var sound_width = 83 * biliWidth;
    var sound_height = parseInt( sound_width / sound_scale);
    dom.width = sound_width;
    dom.height = sound_height;
    dom.style.bottom = 10 + 'px';
    left = BodyWidth / 2 ;
    if(canvas.width < canvas.height) {
      dom.style.left =  (left + canvas.width / 3)+ 'px';
      dom.style.transform = 'rotate('+ 0 + 'deg)';
    } else {
      dom.style.left =  10 + 'px';
      dom.style.transform = 'rotate('+ 90 + 'deg)';
    }
  }
};
resizeCanvas();
//设置canvas 自适应 END
//----------------------------------------------------  
  
  
	images = images||{};
	ss = ss||{};
  var loader = new createjs.LoadQueue(false);
	loader.installPlugin(createjs.Sound);
	loader.addEventListener("fileload", handleFileLoad);
	loader.addEventListener("complete", handleComplete);
  loader.loadFile({src:"images/invitation2_atlas_.json", type:"spritesheet", id:"invitation2_atlas_"}, true);
	loader.loadManifest(lib.properties.manifest);
}

function handleFileLoad(evt) {
	if (evt.item.type == "image") { images[evt.item.id] = evt.result; }
}

function handleComplete(evt) {
  document.getElementById('preload').parentElement.removeChild(document.getElementById('preload'));
	var queue = evt.target;
	ss["invitation2_atlas_"] = queue.getResult("invitation2_atlas_");
	exportRoot = new lib.invitation2();

	stage = new createjs.Stage(canvas);
	stage.addChild(exportRoot);
	stage.update();
	stage.enableMouseOver();

	createjs.Ticker.setFPS(lib.properties.fps);
	createjs.Ticker.addEventListener("tick", bf_one);
}
function bf_one() {
    t = stage.getNumChildren();
    for (var i = t-1; i >= 0; i--) {
      var s = stage.getChildAt(i);
      s.scaleX = biliWidth;
      s.scaleY = biliHeight;
      if (canvas.width > canvas.height) {
        s.rotation = 90; 
        s.x = canvas.width;
      } else {
        s.rotation = 0;
        s.x = 0;
      }
    }
    stage.update();
}
function playSound(id, loop) {
	createjs.Sound.play(id, createjs.Sound.INTERRUPT_EARLY, 0, 0, loop);
}
</script>
</head>

<body onload="init();" style="position: relative;background-color:#D4D4D4" id="body">
	<canvas id="canvas"  style="display: block;margin: 0 auto;background-color:#FFFFFF"></canvas>
	<div style="width: 100%;height:100%;line-height: 100%;position: absolute;top: 50%;left: 50%;" id="preload">
    <!--<div style="display: block;position: absolute;width: 100%;font-size: 28px;margin-left: -56px;margin-top: 70px;">正在加载</div>-->
  </div>
  <img src="images/sound-y.png" style="cursor: pointer;position: absolute;z-index: 2;" id="sound" soundFlg="true" />
</body>
</html>